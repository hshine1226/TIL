<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>PassportJS를 통해 로그인 인증 기능 만들기😊 | Today Junhyuk Learned</title>
    <meta name="generator" content="VuePress 1.6.0">
    <link rel="icon" href="/TIL/images/logo-144.png">
    <link rel="manifest" href="/TIL/manifest.json">
    <meta name="description" content="Junhyuk's Personal Wiki (Today I Learned)">
    <link rel="preload" href="/TIL/assets/css/0.styles.aa841563.css" as="style"><link rel="preload" href="/TIL/assets/js/app.7f3046c4.js" as="script"><link rel="preload" href="/TIL/assets/js/2.34374bbc.js" as="script"><link rel="preload" href="/TIL/assets/js/110.a1ebfb5e.js" as="script"><link rel="prefetch" href="/TIL/assets/js/10.a292076f.js"><link rel="prefetch" href="/TIL/assets/js/100.0f1bdf27.js"><link rel="prefetch" href="/TIL/assets/js/101.c9c33b8a.js"><link rel="prefetch" href="/TIL/assets/js/102.cbff87bc.js"><link rel="prefetch" href="/TIL/assets/js/103.621db7e0.js"><link rel="prefetch" href="/TIL/assets/js/104.48be1980.js"><link rel="prefetch" href="/TIL/assets/js/105.97e1e1b9.js"><link rel="prefetch" href="/TIL/assets/js/106.ff7b96c6.js"><link rel="prefetch" href="/TIL/assets/js/107.91553886.js"><link rel="prefetch" href="/TIL/assets/js/108.79ccf93b.js"><link rel="prefetch" href="/TIL/assets/js/109.aadd92e4.js"><link rel="prefetch" href="/TIL/assets/js/11.a72fa913.js"><link rel="prefetch" href="/TIL/assets/js/111.428c34a3.js"><link rel="prefetch" href="/TIL/assets/js/112.810be18b.js"><link rel="prefetch" href="/TIL/assets/js/113.71a5525c.js"><link rel="prefetch" href="/TIL/assets/js/114.efd7733a.js"><link rel="prefetch" href="/TIL/assets/js/115.06ddd203.js"><link rel="prefetch" href="/TIL/assets/js/116.0bf72d00.js"><link rel="prefetch" href="/TIL/assets/js/117.b29a7cf9.js"><link rel="prefetch" href="/TIL/assets/js/118.1f3ad49c.js"><link rel="prefetch" href="/TIL/assets/js/119.d85e64bb.js"><link rel="prefetch" href="/TIL/assets/js/12.0ee1a3c7.js"><link rel="prefetch" href="/TIL/assets/js/120.01e69188.js"><link rel="prefetch" href="/TIL/assets/js/121.a21f0f4a.js"><link rel="prefetch" href="/TIL/assets/js/122.6580fc73.js"><link rel="prefetch" href="/TIL/assets/js/123.8641a9f6.js"><link rel="prefetch" href="/TIL/assets/js/124.2651b300.js"><link rel="prefetch" href="/TIL/assets/js/125.07a05f61.js"><link rel="prefetch" href="/TIL/assets/js/126.33552cde.js"><link rel="prefetch" href="/TIL/assets/js/127.12a4ab8e.js"><link rel="prefetch" href="/TIL/assets/js/128.9b0399fe.js"><link rel="prefetch" href="/TIL/assets/js/129.807b3ce5.js"><link rel="prefetch" href="/TIL/assets/js/13.d6058049.js"><link rel="prefetch" href="/TIL/assets/js/130.1d470bc1.js"><link rel="prefetch" href="/TIL/assets/js/131.9da4bc56.js"><link rel="prefetch" href="/TIL/assets/js/132.6964abd0.js"><link rel="prefetch" href="/TIL/assets/js/133.59f1907d.js"><link rel="prefetch" href="/TIL/assets/js/134.afce6f12.js"><link rel="prefetch" href="/TIL/assets/js/135.a0c6b6b1.js"><link rel="prefetch" href="/TIL/assets/js/136.5467c3ea.js"><link rel="prefetch" href="/TIL/assets/js/137.b8c6566c.js"><link rel="prefetch" href="/TIL/assets/js/138.78e46d12.js"><link rel="prefetch" href="/TIL/assets/js/139.5295b854.js"><link rel="prefetch" href="/TIL/assets/js/14.90e045dc.js"><link rel="prefetch" href="/TIL/assets/js/140.f0965d7c.js"><link rel="prefetch" href="/TIL/assets/js/141.60dd596c.js"><link rel="prefetch" href="/TIL/assets/js/15.f1b0910e.js"><link rel="prefetch" href="/TIL/assets/js/16.b341a597.js"><link rel="prefetch" href="/TIL/assets/js/17.8af64368.js"><link rel="prefetch" href="/TIL/assets/js/18.94ea4c77.js"><link rel="prefetch" href="/TIL/assets/js/19.0f723af9.js"><link rel="prefetch" href="/TIL/assets/js/20.8e09b11c.js"><link rel="prefetch" href="/TIL/assets/js/21.927b7d58.js"><link rel="prefetch" href="/TIL/assets/js/22.f9da1b8a.js"><link rel="prefetch" href="/TIL/assets/js/23.bfc31ff6.js"><link rel="prefetch" href="/TIL/assets/js/24.6c517461.js"><link rel="prefetch" href="/TIL/assets/js/25.28527e2c.js"><link rel="prefetch" href="/TIL/assets/js/26.f0ca28f5.js"><link rel="prefetch" href="/TIL/assets/js/27.4a56f18c.js"><link rel="prefetch" href="/TIL/assets/js/28.16063c40.js"><link rel="prefetch" href="/TIL/assets/js/29.4392992d.js"><link rel="prefetch" href="/TIL/assets/js/3.fd1fa4c7.js"><link rel="prefetch" href="/TIL/assets/js/30.619aa8c3.js"><link rel="prefetch" href="/TIL/assets/js/31.fbc5ddb5.js"><link rel="prefetch" href="/TIL/assets/js/32.4fa77ecc.js"><link rel="prefetch" href="/TIL/assets/js/33.52c12f24.js"><link rel="prefetch" href="/TIL/assets/js/34.89e88b29.js"><link rel="prefetch" href="/TIL/assets/js/35.4a17a78c.js"><link rel="prefetch" href="/TIL/assets/js/36.8e717bcd.js"><link rel="prefetch" href="/TIL/assets/js/37.2454f641.js"><link rel="prefetch" href="/TIL/assets/js/38.b8c18b22.js"><link rel="prefetch" href="/TIL/assets/js/39.f1256de1.js"><link rel="prefetch" href="/TIL/assets/js/4.ece7ec66.js"><link rel="prefetch" href="/TIL/assets/js/40.28981d2f.js"><link rel="prefetch" href="/TIL/assets/js/41.05d31f50.js"><link rel="prefetch" href="/TIL/assets/js/42.dba5348e.js"><link rel="prefetch" href="/TIL/assets/js/43.2cb725d5.js"><link rel="prefetch" href="/TIL/assets/js/44.5840abad.js"><link rel="prefetch" href="/TIL/assets/js/45.3e987881.js"><link rel="prefetch" href="/TIL/assets/js/46.0bdbb179.js"><link rel="prefetch" href="/TIL/assets/js/47.e43b5935.js"><link rel="prefetch" href="/TIL/assets/js/48.497b3c89.js"><link rel="prefetch" href="/TIL/assets/js/49.b78cb1f2.js"><link rel="prefetch" href="/TIL/assets/js/5.0fcecdc9.js"><link rel="prefetch" href="/TIL/assets/js/50.2cdc693f.js"><link rel="prefetch" href="/TIL/assets/js/51.10df2590.js"><link rel="prefetch" href="/TIL/assets/js/52.70008bdc.js"><link rel="prefetch" href="/TIL/assets/js/53.8cb149a5.js"><link rel="prefetch" href="/TIL/assets/js/54.268c1184.js"><link rel="prefetch" href="/TIL/assets/js/55.b4c18f6b.js"><link rel="prefetch" href="/TIL/assets/js/56.97c8982c.js"><link rel="prefetch" href="/TIL/assets/js/57.1af84b6a.js"><link rel="prefetch" href="/TIL/assets/js/58.db90d043.js"><link rel="prefetch" href="/TIL/assets/js/59.7ad2e390.js"><link rel="prefetch" href="/TIL/assets/js/6.1164652c.js"><link rel="prefetch" href="/TIL/assets/js/60.1f83c852.js"><link rel="prefetch" href="/TIL/assets/js/61.f4354f62.js"><link rel="prefetch" href="/TIL/assets/js/62.b03f1f6e.js"><link rel="prefetch" href="/TIL/assets/js/63.fe430b5e.js"><link rel="prefetch" href="/TIL/assets/js/64.b543935d.js"><link rel="prefetch" href="/TIL/assets/js/65.ea10dce4.js"><link rel="prefetch" href="/TIL/assets/js/66.6278ff79.js"><link rel="prefetch" href="/TIL/assets/js/67.35947c40.js"><link rel="prefetch" href="/TIL/assets/js/68.1fe98a99.js"><link rel="prefetch" href="/TIL/assets/js/69.8eaea716.js"><link rel="prefetch" href="/TIL/assets/js/7.960f9dbd.js"><link rel="prefetch" href="/TIL/assets/js/70.9e5b8c84.js"><link rel="prefetch" href="/TIL/assets/js/71.68b3d6c0.js"><link rel="prefetch" href="/TIL/assets/js/72.0f031936.js"><link rel="prefetch" href="/TIL/assets/js/73.36a4029a.js"><link rel="prefetch" href="/TIL/assets/js/74.d87df022.js"><link rel="prefetch" href="/TIL/assets/js/75.ae5a304b.js"><link rel="prefetch" href="/TIL/assets/js/76.5b51e2ee.js"><link rel="prefetch" href="/TIL/assets/js/77.2992feff.js"><link rel="prefetch" href="/TIL/assets/js/78.abac949f.js"><link rel="prefetch" href="/TIL/assets/js/79.4886846d.js"><link rel="prefetch" href="/TIL/assets/js/8.02936620.js"><link rel="prefetch" href="/TIL/assets/js/80.45606f98.js"><link rel="prefetch" href="/TIL/assets/js/81.ab1d40f8.js"><link rel="prefetch" href="/TIL/assets/js/82.d84542a7.js"><link rel="prefetch" href="/TIL/assets/js/83.44d67b44.js"><link rel="prefetch" href="/TIL/assets/js/84.c3dbd8d4.js"><link rel="prefetch" href="/TIL/assets/js/85.4f29b75a.js"><link rel="prefetch" href="/TIL/assets/js/86.a568dd7f.js"><link rel="prefetch" href="/TIL/assets/js/87.08b558d0.js"><link rel="prefetch" href="/TIL/assets/js/88.1462ef6a.js"><link rel="prefetch" href="/TIL/assets/js/89.e84f04ba.js"><link rel="prefetch" href="/TIL/assets/js/9.608b082f.js"><link rel="prefetch" href="/TIL/assets/js/90.8463a680.js"><link rel="prefetch" href="/TIL/assets/js/91.3d43ba66.js"><link rel="prefetch" href="/TIL/assets/js/92.6ea588a1.js"><link rel="prefetch" href="/TIL/assets/js/93.4d149596.js"><link rel="prefetch" href="/TIL/assets/js/94.894ce4d5.js"><link rel="prefetch" href="/TIL/assets/js/95.76aa72bb.js"><link rel="prefetch" href="/TIL/assets/js/96.54959fa7.js"><link rel="prefetch" href="/TIL/assets/js/97.1f298f62.js"><link rel="prefetch" href="/TIL/assets/js/98.292c3395.js"><link rel="prefetch" href="/TIL/assets/js/99.8e864868.js">
    <link rel="stylesheet" href="/TIL/assets/css/0.styles.aa841563.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/TIL/" class="home-link router-link-active"><!----> <span class="site-name">Today Junhyuk Learned</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/hshine1226/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/@hshine1226/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/hshine1226/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://medium.com/@hshine1226/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Blog
  <svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Data structure[자료구조]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Algorithm[알고리즘]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Markdown[마크다운]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Github[깃허브]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Terminal[터미널]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Alternatives</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vuepress[뷰프레스]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Python[파이썬]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript[자바스크립트]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript[타입스크립트]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React[리액트]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Redux[리덕스]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flask[플라스크]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Node.js</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/TIL/NodeJs/whenIUseNodeJs.html" class="sidebar-link">언제 NodeJS를 사용하는가?</a></li><li><a href="/TIL/NodeJs/passport.html" aria-current="page" class="active sidebar-link">PassportJS를 통해 로그인 인증 기능 만들기😊</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#passport" class="sidebar-link">Passport</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#모듈" class="sidebar-link">모듈</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#localauthentication" class="sidebar-link">LocalAuthentication</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#mongodb를-이용해서-cookie-저장하기" class="sidebar-link">MongoDB를 이용해서 cookie 저장하기</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#middleware를-통해-routes의-출입을-제한하기" class="sidebar-link">Middleware를 통해 Routes의 출입을 제한하기</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#logout" class="sidebar-link">Logout</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#github-login" class="sidebar-link">Github Login</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#facebook-login" class="sidebar-link">Facebook Login</a></li><li class="sidebar-sub-header"><a href="/TIL/NodeJs/passport.html#정리" class="sidebar-link">정리</a></li></ul></li><li><a href="/TIL/NodeJs/passport_changePassword.html" class="sidebar-link">Passport를 통해 Password 변경하기</a></li><li><a href="/TIL/NodeJs/api.html" class="sidebar-link">API 사용하기</a></li><li><a href="/TIL/NodeJs/build.html" class="sidebar-link">Building for production</a></li><li><a href="/TIL/NodeJs/axios.html" class="sidebar-link">axios</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Babel</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Express</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>MongoDB</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Google Cloud</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>AWS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Network</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Heroku[헤로쿠]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Netlify</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Interview[면접]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>English Conversation[영어회화]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Docker[도커]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Colab[코랩]</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Postgresql</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="passportjs를-통해-로그인-인증-기능-만들기😊"><a href="#passportjs를-통해-로그인-인증-기능-만들기😊" class="header-anchor">#</a> PassportJS를 통해 로그인 인증 기능 만들기😊</h1> <h2 id="passport"><a href="#passport" class="header-anchor">#</a> Passport</h2> <p>Passport는 Node.js를 위한 Authentication Middleware이다.</p> <p>우리는 사용자 인증을 구현하기 위해서 Passport라는 미들웨어를 사용할 것이다.</p> <p>인증(Authentication)이란 브라우저 상에서 쿠키를 설정해주면 그 쿠키를 통해서 사용자 ID 등을 알 수 있고, 이를 통해 Passport까 브라우저에서 자동으로 쿠키를 가져와서 인증이 완료된 User Object를 Controller에 넘겨주는 것이다.</p> <p>그리고 Passport는 작은 모듈들로 이루어져 있어서 대부분의 다른 서비스들(페이스북, 깃허브, 구글, 스팀 등)로부터 인증을 받을 수도 있다.</p> <blockquote><p>쿠키: 쿠키는 우리가 브라우저에 저장할 수 있는 것들이다. 이 정보에는 모든 요청(Request)에 대해서 백엔드로 전송될 정보들이 담겨져 있다.</p></blockquote> <p>Passport가 하는 일은 쿠키의 생성, 저장을 한 이후에 해당 쿠키를 유저에게 보내주는 역할을 한다. 실제 과정은 이것보다 훨씬 더 복잡하지만 그 부분에 대해서는 Passport가 알아서 해주니 너무 걱정하지 않아도 된다.</p> <p>Passport에서 코드 구현은 아래에서 보는 것과 같이 그리 복잡하지 않다.</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">,</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// If this function gets called, authentication was successful.</span>
  <span class="token comment">// `req.user` contains the authenticated user.</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/users/&quot;</span> <span class="token operator">+</span> req<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>누군가 <code>/login</code>으로 post를 하면 <code>passport.authenticate</code>라는 것을 호출한다. 그리고 <code>'local'</code>이라는 것은 Strategy(전략)이라고 하는 것이다. 우리의 경우에는 'facebook,', 'github' 등과 같은 전략을 사용할 수 있다.</p> <p>그리고 인증이 되고난 후에는 function이 실행된다. 그리고 function안을 살펴보면 <code>req.user</code>라는 것을 볼 수 있다. 보다시피 Passport는 직접 <code>req.user</code>를 만들어준다. 이것이 바로 현재 로그인한 사용자가 된다.</p> <h2 id="모듈"><a href="#모듈" class="header-anchor">#</a> 모듈</h2> <h3 id="passport-local-mongoose"><a href="#passport-local-mongoose" class="header-anchor">#</a> passport-local-mongoose</h3> <p>passport-local-mongoose 모듈은 사용자 기능(User functionality)을 추가해주는 모듈이다. 우리의 User model을 위해서 사용될 것이다. 기본적인 사용자 인증 기능(패스워드 생성, 변경, 확인 암호화 등)</p> <h2 id="localauthentication"><a href="#localauthentication" class="header-anchor">#</a> LocalAuthentication</h2> <p>name, email, avatarUrl 등을 가지는 User라는 Model을 아래와 같이 생성한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// models/User.js</span>

<span class="token keyword">import</span> mongoose <span class="token keyword">from</span> <span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> passportLocalMongoose <span class="token keyword">from</span> <span class="token string">&quot;passport-local-mongoose&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token operator">:</span> String<span class="token punctuation">,</span>
  email<span class="token operator">:</span> String<span class="token punctuation">,</span>
  avatarUrl<span class="token operator">:</span> String<span class="token punctuation">,</span>
  facebookId<span class="token operator">:</span> Number<span class="token punctuation">,</span>
  githubId<span class="token operator">:</span> Number<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Mongoose, MongoDB를 사용하기 때문에 passport-local-mongoose을 플러그인으로서 추가한다.</span>
userSchema<span class="token punctuation">.</span><span class="token function">plugin</span><span class="token punctuation">(</span>passportLocalMongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> usernameField<span class="token operator">:</span> <span class="token string">&quot;email&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> model <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">Model</span><span class="token punctuation">(</span><span class="token string">&quot;User&quot;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> model<span class="token punctuation">;</span>
</code></pre></div><h3 id="passport-local-mongoose-2"><a href="#passport-local-mongoose-2" class="header-anchor">#</a> Passport-Local Mongoose</h3> <p><a href="https://github.com/saintedlama/passport-local-mongoose" target="_blank" rel="noopener noreferrer">Passport-Local Mongoose<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>는 패스워드 설정, 확인 등을 자동적으로 해주는 Mongoose Plugin이다. Document를 참고하면 setPassword, changPassword, authenticate 등 여러 인스턴스 메소드들을 확인할 수 있다. 그리고 Main Options 항목에서 여러가지 옵션들을 확인할 수 있는데, 그중 우리는 usernameField라는 옵션을 사용할 것이다. 이 옵션을 사용하게 되면 username으로 field를 명시한다. 여기서 username은 내 이름이 될 수도 있고, 이메일이 될 수도 있다. 아무튼 passportLocalMongoose에게 어떤 Field를 username으로 사용할 것인지를 알려줘야한다. 우리는 일단 email을 username으로 사용할 것이다.</p> <blockquote><p>설치: <code>npm install passport-local-mongoose</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// passport.js</span>

<span class="token keyword">import</span> passport <span class="token keyword">from</span> <span class="token string">&quot;passport&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">&quot;./models/User&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// passport에게 Statege(로그인 하는 방식)을 사용하라고 말하는 것이다.</span>
passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token function">createStrategy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="paaport-passport-local"><a href="#paaport-passport-local" class="header-anchor">#</a> paaport, passport-local</h3> <blockquote><p>설치: npm install passport passport-local</p> <blockquote><p>passport는 passport이고, passport-local은 username과 password를 쓰는 사용자 인증 방식(Strategy)를 의미한다.</p></blockquote></blockquote> <p>Passport에서 Stategy는 로그인 하는 방식을 의미하는 말로서 예를들어 페이스북으로 로그인하기, 깃허브로 로그인하기, username과 password로 로그인하기 등을 말한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// init.js</span>

<span class="token keyword">import</span> <span class="token string">&quot;./models/User&quot;</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="serializeuser-deserializeuser"><a href="#serializeuser-deserializeuser" class="header-anchor">#</a> serializeUser, deserializeUser</h3> <blockquote><p>serializeUser</p> <p>'어떤 정보를 쿠키에게 주느냐', '쿠키가 어떤 정보를 가질 수 있느냐'</p> <p>'어떤 field가 쿠키에 포함될 것인지를 알려주는 역할을 함'</p></blockquote> <blockquote><p>deserializeUser</p> <p>'어느 사용자인지 어떻게 찾는가', '쿠키의 정보를 어떻게 사용자로 전환하는가'</p></blockquote> <p>쿠키에는 너무 많은 정보를 주면 안된다. 쿠키는 아주 작기 때문에 민감한 정보를 담으면 보안에 취약하다.</p> <p>passport-local-mongoose 덕분에 아래와 같이 shortcut을 사용할 수 있다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// passport.js</span>

<span class="token comment">// ...</span>

<span class="token comment">// 오직 user.id만 담아서 보내는 것</span>
passport<span class="token punctuation">.</span><span class="token function">serializeUser</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token function">serializeUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// deserializeUser</span>
passport<span class="token punctuation">.</span><span class="token function">deserializeUser</span><span class="token punctuation">(</span>User<span class="token punctuation">.</span><span class="token function">deserializeUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controllers/userController.js</span>
<span class="token keyword">import</span> User <span class="token keyword">from</span> <span class="token string">&quot;../models/User&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">postJoin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    body<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> password2 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">!==</span> password2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 잘못된 요청</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;join&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> pageTitle<span class="token operator">:</span> <span class="token string">&quot;Join&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// Register User</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 계정 생성</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">,</span>
        email<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 계정 가입</span>
      <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>postJoin을 미들웨어로 만들것이다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/globalRouter.js</span>
globalRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>join<span class="token punctuation">,</span> postJoin<span class="token punctuation">,</span> postLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controllers/userController.js</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">postJoin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    body<span class="token operator">:</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> password<span class="token punctuation">,</span> password2 <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> req<span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>password <span class="token operator">!==</span> password2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 잘못된 요청</span>
    res<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token string">&quot;join&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> pageTitle<span class="token operator">:</span> <span class="token string">&quot;Join&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        name<span class="token punctuation">,</span>
        email<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>user<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 미들웨어 수행후 다음으로 넘어가기</span>
      <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// To Do: Log user in</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// local Strategy로 passport 인증</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> postLogin <span class="token operator">=</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">&quot;local&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token comment">// 로그인에 실패하면 로그인화면으로</span>
  <span class="token comment">// 성공하면 홈으로 redirect 해준다.</span>
  failureRedirect<span class="token operator">:</span> routes<span class="token punctuation">.</span>login<span class="token punctuation">,</span>
  successRedirect<span class="token operator">:</span> routes<span class="token punctuation">.</span>home<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// middlewares.js</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">localsMiddleware</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>siteName <span class="token operator">=</span> <span class="token string">&quot;YouTube&quot;</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>routes <span class="token operator">=</span> routes<span class="token punctuation">;</span>
  <span class="token comment">// passport가 사용자를 로그인 시킬 때 user가 담긴 object를 req에 올려준다.</span>
  <span class="token comment">// 따라서 이를 템플릿에서 사용하기 위해 미들웨어에서 아래와 같이 user를 저장한다.</span>
  res<span class="token punctuation">.</span>locals<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>user <span class="token operator">||</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>passport를 import하고, use한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>

<span class="token keyword">import</span> passport <span class="token keyword">from</span> <span class="token string">&quot;passport&quot;</span><span class="token punctuation">;</span>
<span class="token comment">// ...</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">initialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>passport<span class="token punctuation">.</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ...</span>
</code></pre></div><h3 id="session"><a href="#session" class="header-anchor">#</a> session</h3> <p><code>npm install express-session</code>으로 session을 설치한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>

<span class="token keyword">import</span> session <span class="token keyword">from</span> <span class="token string">&quot;express-session&quot;</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// secret은 무작위 문자열로서 session ID를 암호화 한다.</span>
    secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COOKIE_SECRET</span><span class="token punctuation">,</span>
    resave<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><a href="https://randomkeygen.com/" target="_blank" rel="noopener noreferrer">randomkeygen<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>에서 random한 무작위의 key를 얻을 수 있다.</p> <div class="language- extra-class"><pre class="language-text"><code>// .env
// randomkeygen에서 얻은 key값 저장
COOKIE_SECRET = &quot;VspO%ub8mfs-0$&amp;&gt;9*6~tKH&lt;F![[Z~&quot;&quot;

</code></pre></div><p><code>header.pug</code>에서 user.isAuthentication이 없어졌으므로 그냥 user로 변경해준다.</p> <div class="language-pug extra-class"><pre class="language-pug"><code><span class="token comment">// ...</span>
<span class="token tag"><span class="token attr-class">.header__column</span></span>
			<span class="token tag">ul</span>
				<span class="token flow-control"><span class="token branch keyword">if</span> <span class="token operator">!</span>user</span>
					<span class="token comment">// ...</span>
</code></pre></div><p>로그인이 잘 되는지 확인해보면 로그인과 쿠키가 정상적으로 되는 것을 볼 수 있다.</p> <p>하지만, 페이지를 새로고침 해보면 쿠키가 없어지는 것을 볼 수 있다.</p> <p>이것을 mongoDB를 이용해서 해결해보자.</p> <h2 id="mongodb를-이용해서-cookie-저장하기"><a href="#mongodb를-이용해서-cookie-저장하기" class="header-anchor">#</a> MongoDB를 이용해서 cookie 저장하기</h2> <p><code>npm install connect-mongo</code>로 connect-mongo를 설치한다.</p> <p>Session을 MongoDB에 저장해서 브라우저가 새로고침 되어도 세션이 유지되게 한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js</span>
<span class="token keyword">import</span> mongoose <span class="token keyword">from</span> <span class="token string">&quot;mongoose&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> MongoStore <span class="token keyword">from</span> <span class="token string">&quot;connect-mongo&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> CookieStore <span class="token operator">=</span> <span class="token function">MongoStore</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">session</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    secret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COOKIE_SECRET</span><span class="token punctuation">,</span>
    resave<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    saveUninitialized<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    store<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">CookieStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span> mongooseConnection<span class="token operator">:</span> mongoose<span class="token punctuation">.</span>connection <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="middleware를-통해-routes의-출입을-제한하기"><a href="#middleware를-통해-routes의-출입을-제한하기" class="header-anchor">#</a> Middleware를 통해 Routes의 출입을 제한하기</h2> <h3 id="middleware-생성"><a href="#middleware-생성" class="header-anchor">#</a> Middleware 생성</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// middlewares.js</span>
<span class="token comment">// 로그인한 사용자라면 홈으로 Redirect 해준다.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">onlyPublic</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 로그인하지 않은 사용자라면 홈으로 Redirect 해준다.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">onlyPrivate</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="router-설정"><a href="#router-설정" class="header-anchor">#</a> Router 설정</h3> <p>위에서 만든 미들웨어를 통해 Router에서 해당하는 경로에 대해서 출입을 제한한다.</p> <p>예를들어서 로그인한 유저는 Join, Login에 접속하지 못하게 하는 것, 로그인하지 않은 유저는 프로필 수정, 패스워드 변경을 제한하는 것 등이 있다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/globalRouter.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onlyPublic<span class="token punctuation">,</span> onlyPrivate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../middlewares&quot;</span><span class="token punctuation">;</span>

globalRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>join<span class="token punctuation">,</span> onlyPublic<span class="token punctuation">,</span> getJoin<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>join<span class="token punctuation">,</span> onlyPublic<span class="token punctuation">,</span> postJoin<span class="token punctuation">,</span> postLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>logout<span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> logout<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/userRouter.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> onlyPrivate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../middlewares&quot;</span><span class="token punctuation">;</span>

userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>editProfile<span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> editProfile<span class="token punctuation">)</span><span class="token punctuation">;</span>
userRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>changePassword<span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> changePassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/globalRouter.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> uploadVideo<span class="token punctuation">,</span> onlyPrivate <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;../middlewares&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// Upload</span>
videoRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>upload<span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> getUpload<span class="token punctuation">)</span><span class="token punctuation">;</span>
videoRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>upload<span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> uploadVideo<span class="token punctuation">,</span> postUpload<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Edit Video</span>
videoRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span><span class="token function">editVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> getEditVideo<span class="token punctuation">)</span><span class="token punctuation">;</span>
videoRouter<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span><span class="token function">editVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> postEditVideo<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Delete Video</span>
videoRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span><span class="token function">deleteVideo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> onlyPrivate<span class="token punctuation">,</span> deleteVideo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="logout"><a href="#logout" class="header-anchor">#</a> Logout</h2> <p>로그아웃은 정말 간단하다. 아래와 같이 <code>req.logout()</code>만 추가해주면 passport가 알아서 처리해준다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">logout</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  req<span class="token punctuation">.</span><span class="token function">logout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>home<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="github-login"><a href="#github-login" class="header-anchor">#</a> Github Login</h2> <p>passport strategies 중에서 passport-github를 사용해 github 로그인을 구현할 것이다.</p> <p><code>npm install passport-github</code>로 설치 후에 먼저 <a href="https://github.com/settings/applications/new" target="_blank" rel="noopener noreferrer">developer application<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>에서 새로운 Application을 생성해야 한다. 이때 callback URL은 <code>http://localhost:4000/auth/github/callback</code>과 같이 작성한다. 이것은 변경해도 상관 없다.</p> <h3 id="환경변수-추가"><a href="#환경변수-추가" class="header-anchor">#</a> 환경변수 추가</h3> <p>Application 생성완료되면, Client ID와 Client Secret는 다른사람과는 절대 공유하면 안되기 때문에, .env 환경변수 파일에 Client ID와 Client Secret을 선언했다.</p> <div class="language- extra-class"><pre class="language-text"><code>// .env
GITHUB_CLIENT_ID = &quot;88d41a39a8e6af4103ff&quot;
GITHUB_CLIENT_SECRET = &quot;35f3bc886295a7fada74a386a2f7a4b3c303f460&quot;
</code></pre></div><h3 id="configure-strategy"><a href="#configure-strategy" class="header-anchor">#</a> Configure Strategy</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// passport.js</span>
<span class="token comment">// ...</span>
passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">GithubStrategy</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      clientID<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_CLIENT_ID</span><span class="token punctuation">,</span>
      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">GITHUB_CLIENT_SECRET</span><span class="token punctuation">,</span>
      <span class="token comment">// routes.githubCallback: /auth/github/callback</span>
      callbackURL<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:4000</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routes<span class="token punctuation">.</span>githubCallback<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// userController.js에 선언됨</span>
    githubLoginCallback
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controllers/userController.js</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> githubLogin <span class="token operator">=</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">&quot;github&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 첫번째와 두번째 Parameter는 사용하지 않는 Parameter이므로 언더바(_)로 선언했다.</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">githubLoginCallback</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> __<span class="token punctuation">,</span> profile<span class="token punctuation">,</span> cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// profile의 _json이라는 필드에서 받아온 값들이다.</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>
    _json<span class="token operator">:</span> <span class="token punctuation">{</span> id<span class="token punctuation">,</span> avatar_url<span class="token operator">:</span> avatarUrl<span class="token punctuation">,</span> name<span class="token punctuation">,</span> email <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span> <span class="token operator">=</span> profile<span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// MongoDB에서 email을 기준으로 유저를 찾는다.</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 해당 유저가 존재한다면, 아래와 같이 id, avatar를 저장하고 callback function으로 유저를 전달한다.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      user<span class="token punctuation">.</span>githubId <span class="token operator">=</span> id<span class="token punctuation">;</span>
      user<span class="token punctuation">.</span>avatarUrl <span class="token operator">=</span> avatarUrl<span class="token punctuation">;</span>
      user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 해당 유저가 존재하지 않는다면, 아래와 같이 새로운 유저를 만들고, Callback Function으로 새로운 유저를 전달한다.</span>
    <span class="token keyword">const</span> newUser <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      email<span class="token punctuation">,</span>
      name<span class="token punctuation">,</span>
      githubId<span class="token operator">:</span> id<span class="token punctuation">,</span>
      avatarUrl<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> newUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">cb</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="requests"><a href="#requests" class="header-anchor">#</a> Requests</h3> <p>위에서 Github Strategy의 설정을 완료하고 이제는 Routes, Router 설정을 해줘야 한다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Github</span>
<span class="token keyword">const</span> <span class="token constant">GITHUB</span> <span class="token operator">=</span> <span class="token string">&quot;/auth/github&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">GITHUB_CALLBACK</span> <span class="token operator">=</span> <span class="token string">&quot;/auth/github/callback&quot;</span><span class="token punctuation">;</span>

github<span class="token operator">:</span> <span class="token constant">GITHUB</span><span class="token punctuation">,</span>
githubCallback<span class="token operator">:</span> <span class="token constant">GITHUB_CALLBACK</span><span class="token punctuation">,</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// routers/globalRouter.js</span>

globalRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>routes<span class="token punctuation">.</span>github<span class="token punctuation">,</span> githubLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
globalRouter<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>
  routes<span class="token punctuation">.</span>githubCallback<span class="token punctuation">,</span>
  passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">&quot;github&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> failureRedirect<span class="token operator">:</span> <span class="token string">&quot;/login&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  postGithubLogin
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-pug extra-class"><pre class="language-pug"><code><span class="token comment">// views/partials/socialLogin.pug</span>
<span class="token tag"><span class="token attr-class">.social-login</span></span>
    <span class="token tag">button<span class="token attr-class">.social-login--github</span></span>
        <span class="token tag">a<span class="token attributes"><span class="token punctuation">(</span><span class="token attr-name">href</span><span class="token punctuation">=</span><span class="token attr-value">routes<span class="token punctuation">.</span>github</span><span class="token punctuation">)</span></span></span>
            <span class="token tag">span</span> 
                <span class="token tag">i<span class="token attr-class">.fab</span><span class="token attr-class">.fa-github</span></span>
            <span class="token punctuation">|</span> Continue with Github
</code></pre></div><h2 id="facebook-login"><a href="#facebook-login" class="header-anchor">#</a> Facebook Login</h2> <p>Facebook login 구현 방식은 Github와 Google과 매우 비슷하지만 한가지 다른 점이 있다. 그것은 보안 문제로 facebook이 까다롭기 때문에 https를 써야하는 것이다.</p> <h3 id="facebook-developer-설정"><a href="#facebook-developer-설정" class="header-anchor">#</a> Facebook Developer 설정</h3> <p>따라서 <a href="https://developers.facebook.com/" target="_blank" rel="noopener noreferrer">Facebook Developer<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>에서 설정해야 할 것들이 있다.</p> <ol><li>앱을 만든다.</li> <li>웹사이트 URL을 추가한다.</li> <li>상단에 보면 앱 ID 옆에 개발모드와 Live모드가 있는데 이 모드를 Live 모드로 하게 되면 https를 사용해야 한다. 따라서 우리는 개발 모드로 변경한다.</li> <li>앱 검수 - 내 권한 및 기능에서 email과 default를 승인 받아야 해당 정보들을 받아올 수 있다.</li></ol> <h3 id="scope-profilefield-옵션-사용"><a href="#scope-profilefield-옵션-사용" class="header-anchor">#</a> Scope, profileField 옵션 사용</h3> <p>Developer 사이트에서 모든 설정을 마쳤다면 <code>passport.authenticate()</code>의 scope 옵션과 profilefield 옵션을 사용해야한다. <a href="http://www.passportjs.org/packages/passport-facebook/" target="_blank" rel="noopener noreferrer">passport-facebook<svg xmlns="http://www.w3.org/2000/svg" aria-labelledby="outbound-link-title" role="img" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><title id="outbound-link-title">(opens new window)</title> <path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 옵션을 확인할 수 있다.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// passport.js</span>

passport<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token keyword">new</span> <span class="token class-name">FacebookStrategy</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      clientID<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FACEBOOK_CLIENT_ID</span><span class="token punctuation">,</span>
      clientSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">FACEBOOK_CLIENT_SECRET</span><span class="token punctuation">,</span>
      callbackURL<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">http://localhost:4000</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>routes<span class="token punctuation">.</span>facebookCallback<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token comment">// profileFields 옵션으로 id, name, photo, email을 요청한다.</span>
      profileFields<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;displayName&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;photos&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    facebookLoginCallback
  <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// controllers/userController.js</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> facebookLogin <span class="token operator">=</span> passport<span class="token punctuation">.</span><span class="token function">authenticate</span><span class="token punctuation">(</span><span class="token string">&quot;facebook&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  	<span class="token comment">// scope를 통해서 우리가 필요한 email의 권한을 요청한다.</span>
    scope<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;email&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="정리"><a href="#정리" class="header-anchor">#</a> 정리</h2> <h3 id="local-방식-인증-authentication"><a href="#local-방식-인증-authentication" class="header-anchor">#</a> Local 방식 인증(Authentication)</h3> <p>Local 방식은 User name과 Password를 이용한 인증 방식으로 비교적 간단하게 구현할 수 있다.</p> <ul><li>Username과 Password를 Post 방식으로 전달</li> <li>passport-local-mongoose가 Password가 맞는지 체크</li> <li>Password가 맞다면 Passport는 Cookie를 생성</li></ul> <h3 id="github-google-facebook-and-etc-인증-authentication"><a href="#github-google-facebook-and-etc-인증-authentication" class="header-anchor">#</a> Github, Google, Facebook and etc 인증(Authentication)</h3> <p>Github 방식은 Local 방식과는 다르다.</p> <ul><li>사용자는 깃허브 인증 페이지로 이동해서 권한 승인을 한다.</li> <li>깃허브 인증 페이지는 /auth/gihub/callback 이라는 URL로 사용자의 정보를 보내준다.</li> <li>Passport는 우리가 만든 githubLoginCallback 함수를 호출한다.</li> <li>해당 함수를 통해서 사용자의 모든 정보를 받는다.(profile)
<ul><li>해당 함수의 조건은 callback함수를 Return 하는것이다.</li></ul></li> <li>Callback 함수를 통해 받은 Return에 user가 존재하면, Passport는 이 user를 통해 Cookie를 만든다.</li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/TIL/NodeJs/whenIUseNodeJs.html" class="prev">
        언제 NodeJS를 사용하는가?
      </a></span> <span class="next"><a href="/TIL/NodeJs/passport_changePassword.html">
        Passport를 통해 Password 변경하기
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/TIL/assets/js/app.7f3046c4.js" defer></script><script src="/TIL/assets/js/2.34374bbc.js" defer></script><script src="/TIL/assets/js/110.a1ebfb5e.js" defer></script>
  </body>
</html>
